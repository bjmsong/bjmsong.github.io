---
layout:     post
title:      推荐系统三十六式之
subtitle:   常见架构
date:       2020-04-18
author:     bjmsong
header-img: img/Recommendation System/th.jpg
catalog: true
tags:
    - 推荐系统
---
>



### 信息流架构

#### 整体框架

- 搜索paper关键词：Activity Stream
- 模块
    - 日志收集
    - 内容发布
    - 机器学习
    - 信息流服务
        - 为信息流的展示前端提供Rest API
    - 监控
- 数据模型
    - user
        - mysql
    - activity
        - mysql、redis、cassandra
    - connection
        - mysql
- 信息流推送
    - Celery等框架
- 信息流排序
    - 通常做成RPC服务，供调用
- 数据管道

- Netflix推荐架构
    - 工程实现才是推荐系统的骨架
    - 好的推荐系统架构
        - 实时响应需求
        - 及时、准确、全面记录用户反馈
        - 可以优雅降级
        - 快速试验多种策略
    - 架构
        - 离线层：不用实时数据，不提供实时服务
        - 近线层：使用实时数据，不保证实时服务
        - 在线层：使用实时数据，要保证实时服务
- 推荐架构和搜索、广告的关系


### 关键模块
- 数据采集
    - 数据模型
        - 把数据归类
        - 用户属性、物品属性、事件（曝光、浏览、购买）、关系数据
    - 数据在哪
        - 基本信息
        - 埋点
            - SDK埋点
            - 可视化埋点
            - 无埋点：尽可能多的收集所有数据
            - 神策、友盟。。。
    - 元素有哪些
    - 如何收集
    - 质量检验
- 实时推荐
    - 实时数据
        - 实时消息队列
        - kafka
    - 流计算
        - storm
        - flink
- 实验平台
    - ABtest
- 服务化、存储选型及API设计
    - 存储
        - 离线阶段得到的结果，存进数据库，供近线阶段更新，最终在在线阶段直接使用
        - 数据类型
            - 特征
                - 稀疏 稠密
                - 正排：用户ID或者物品ID作为主键  -- 列式数据库
                  倒排：特征作为主键 -- KV数据库
            - 模型
            - 结果
        - 不同存储方式
            - 列式数据库
                - 适合批量写入和批量查询
                - Cassandra，HBase
            - 键值数据库
                - Redis
                - 数据放在内存中
                - 场景
                    - 消息队列
                    - 优先队列
                    - 模型参数
            - 非数据库
                - 虚拟内存映射
                - PMML
                    - 适合模型参数比较少
                    - 线上服务预测时不依赖离线时的编程语言
    - API
        - 数据录入
        - 推荐服务

### 效果保证
- 测试方法
    - 业务规则扫描
        - 将业务规则翻译成单元测试
    - 离线模拟测试
        - topK：AUC
    - 在线对比测试
        - ABTest
    - 用户访谈
- 常见指标
    - 系统有多好
        - 深度
            - 评分准确度：RMSE
            - 排序：AUC
                - 而不是用采用搜索引擎排序指标(MAP、MRR、NDCG),因为推荐结果非常个人化
            - 分类准确率
                - topK：准确率，召回率
        - 广度
             - 覆盖率
             - 失效率
             - 新颖性
             - 更新率
    - 还能好多久
        - 个性化
        - 基尼系数
        - 多样性
- 推荐系统的攻防



### 开源工具
慎重选择分布式，先把单机发挥到极致，除非过亿用户以上
- 内容分析
    - 主题模型
        - LightLDA
        - gensim
        - plda
    - 词嵌入
        - gensim
        - tensorflow-word2vec
        - Fasttext
    - 文本分类
        - Fasttext
        - liblinear
- 协同过滤和矩阵分解
协同过滤：通过计算矩阵的行相似和列相似得到推荐结果
矩阵分解：得到用户和物品的隐因子向量，是低维稠密向量，进一步以用户的低维稠密向量在物品的向量中搜索得到近邻结果
    - KNN相似度计算
    - SVD矩阵分解
    - SVD++矩阵分解
    - ALS矩阵分解
    - BPR矩阵分解
    - 低维稠密向量近邻搜索
  simHash
  Faiss nmslib
- 模型融合
线性模型训练部分离线批量进行，线上预测部分比较简单，可以用开源的接口，也可以自己实现
    - LightGBM
    - XGBOOST
    - tensorflow-wide&deep
    - libFFM
    - vowpal_wabbit 
- 其他
    - bandit：自己实现
    - 深度学习：tensorflow
    - 存储、接口
- 完整推荐系统:算法+存储+接口
    - PredictionIO
    - recommendationRaccon
    - easyrec
    - hapiger