---
layout:     post
title:      推荐系统之数据源
subtitle:   
date:       2020-01-03
author:     bjmsong
header-img: img/Recommendation System/th.jpg
catalog: true
tags:
    - 推荐系统
---

### 行为数据
即互联网行为中， 用户活动数据，用户与Item之间的交互数据，也包括交互行为产生的上下文数据，如网络情况、地理位置、时间等等，用户行为数据在网站上最简单的存在形式就是日志。很多互联网业务会把多种原始日志按照用户行为汇总成会话日志（session log），其中每个会话表示一次用户行为和对应的服务。比如，在搜索引擎和搜索广告系统中，服务会为每次查询生成一个展示日志（impression log），其中记录了查询和返回结果。如果用户点击了某个结果，这个点击信息会被服务器截获并存储在点击日志（click log）中。



#### 行为数据获取方式: 埋点

埋点学名叫事件跟踪，对应英文为 Event Tracking, 是指通过技术手段在 网站、APP 中特点流程收集一些信息，用来跟踪应用使用情况，后续用来优 化产品，比如个性化推荐、统计页面操作行为等；

- 行为埋点目的
  - 行为数据的埋点时数据业务的基础准备工作，只有在收集到一定数据之 后，相关的数据业务才有支撑。
- 埋点数据内容
  - 行为数据：交互时间、交互位置、交互 Item、交互类型、交互停留时间 等等；
  - 质量数据：浏览器或APP页面浏览情况、是否出错、出错调试信息； 
  - 上下文数据：用户浏览 Item 的时间、网络运营商、设备类型等数据； 
  - 基础的数据通过埋点获取后，通过基础的统计工具，可以得到 APP 某个页面 PV、UV 统计，某个页面转化率、页面入口等，用户平均时长；还可以通过解析埋点日志，统计某些场景的点击、收藏等行为数据，建立点击、收藏模型， 给用户提供提供更感兴趣的内容，提高用户粘性。

- 如何行为埋点

  - 埋点听着简单，其实要完成好相应的工作，是〸分复杂的，通常会根据业务场景的不同选择不同的埋点方案。
  - 埋点的主流有三种方式：
    - 代码埋点：是指工程师将埋点逻辑结合到代码中，能够识别用 户客户端的额各种操作，然后组装成消息列表，传到后台落地到日志；	
    - 可视化埋点；可视化埋点可以说是一种自动化的代码埋点，它简化了埋 点逻辑，可以直接通过交互行为完成埋点的自动化生成，并且由于内部 已经集成采集逻辑，埋点部署客户端可以做到实时生效；
    - 全埋点：全埋点也称“不埋点”，将页面所有的交互行均进行采集，其优点 在于能够采集所有数据，能够满足后期需求，缺点是采集数据量很大，通 信成本高。
  - 三种埋点方式各有优缺点：
    - 全埋点能够采集非常多的数据，适合页面逻辑 比较少的场景，一次上线后，后期不需要频繁进行埋点优化
    - 可视化埋点适合页面逻辑简单，可频繁添加埋点项的场景，其埋点逻辑容易被穷举，能够简单被复制且不需网站或 APP更新
    - 代码埋点缺点比较明显，因为需要工程师开 发，且需要网站或者 APP 版本更新，会花费更多资源，但是代码埋点灵活性 更高，可以自定义采集时间，如页面停留时间、页面浏览路径、音乐播放市场、 用户浏览轨迹等等；

- 收集哪些数据

采集数据和业务场景强相关，通常有业务人员整理需求，产品经理理解， 格式化为指标，工程人员通过指标来统计相应数据完成统计工作，常见的数据包括：

1. 基础行为统计：如在电商场景中，访客曝光、浏览、点击/收藏/下单/评 论某 SKU 统计，这类是基础指标，不但可以统计用户维度的行为，后期还可以统计到 SKU 维度，如 SKU A 曝光/浏览/点击/收藏/下单/评论 用户数，也可以后期经过处理，得到是否用户感兴趣的正负样本，训练 点击率预估模型；
2. 停留时长：页面停留时长数据，表明用户在某页面或者一次 session 的停 留时间，如在 feeds 流场景，目的为了提升用户沉浸式体验，增加用户消 费时间，达到商业变现的目的，因此，页面或者 session 停留时长会成为 很多优化迭代评判的核心指标；
3. 浏览轨迹：在电商场景中，商品浏览轨迹的数据采集〸分重要，在用户浏 览过 ItemA、ItemB 之后，再去浏览 ItemC，甚至主动行为去浏览 ItemC （如通过页面内搜索工具）这部分信息在 session 对话里面蕴含很多信息 量，已有相关团队在利用 session 内浏览情况，预测用户下一步感兴趣 Item；
4. 元数据：元数据在上述采集数据均会使用到，包括用户、页面、时间均 被唯一标记，如用户 ID、cookies，页面通常会根据页面内容自动化生成 ID，另外还包括设备基础信息，时间戳，浏览网络环境（Wifi 或者移动 流量），等等；
   以上简单描述了在企业界，数据埋点的一些基本情况，算作浅尝则止，一个合 理的埋点场景需要前端、后台、UI 设计、产品经理协同作业完成，本身是一 个特别复杂的事情，本身涉及技术深度可能有限，但是扩团队的合作，需求的 整理〸分复杂，这里不做深究。



### Explicit feedback

- Ratings: numerical ratings of movies on IMDB or Netflix
- Survey results: survey on items with rating, satisfaction level
- Reviews: text reviews with positive or negative sentiment



### Implicit feedback

- Click / no click
- Purchase / no purchase
- #clicks, #purchases, #pointing links
- User engagement
- CTR / conversion rate / impression / attempt


<ul> 
<li markdown="1"> 
![]({{site.baseurl}}/img/Recommendation System/显式vs隐式.png) 
</li> 
</ul> 





### 用户画像（User Profile）

- 用户画像到底是什么
  - 是对用户信息的向量化表示，为什么不向量化表示不行呢？因为没办法交给计算机计算
  - 用户画像是给机器看的，而不是给人看的，越酷炫的用户画像越没什么用 。
- 用户画像的关键元素有哪些：维度、量化
- 用户画像是跟着使用效果走的，用户画像本身并不是目的

<ul> 
<li markdown="1"> 
用户画像是一个复杂的系统，随着产品逐渐成熟，会根据不同的业务场景设计不同的标签，用户画像要齐全
![]({{site.baseurl}}/img/Recommendation System/user profile.jpg) 
</li> 
</ul> 

- 构建方法
- 查户口：直接使用原始数据作为用户画像的内容，如注册资料等人口统计学信息，或者购买历史，阅读历史等，除了数据清洗等工作，数据本身并没有做任何抽象和归纳
  - 堆数据：做统计工作，这是最常见的用户画像数据，常见的兴趣标签，就是这一类，就是从历史行为数据中去挖掘出标签，然后在标签维度上做数据统计，用统计结果作为量化结果

  - 机器学习：学习出人类无法直观理解的稠密向量。比如使用潜语义模型构建用户阅读兴趣，或者使用矩阵分解得到的隐因子，或者使用深度学习模型学习用户的 Embedding 向量。这一类用户画像数据通常不可解释，不能直接被人看懂。



#### 构建流程

<ul> 
<li markdown="1"> 
![]({{site.baseurl}}/img/Recommendation System/构建流程.png) 
</li> 
</ul> 

- 数据收集
  - 数据收集大致分为网络行为数据、服务内行为数据、用户内容偏好数据、用户交易数据这四类。
    - 网络行为数据：活跃人数、页面浏览量、访问时长、激活率、外部触点、社交数据等
    - 服务内行为数据：浏览路径、页面停留时间、访问深度、唯一页面浏览次数等
    - 用户内容便好数据：浏览／收藏内容、评论内容、互动内容、生活形态偏好、品牌偏好等
    - 用户交易数据（交易类服务）：贡献率、客单价、连带率、回头率、流失率等
  - 当然，收集到的数据不会是100%准确的，都具有不确定性，这就需要在后面的阶段中建模来再判断，比如某用户在性别一栏填的男，但通过其行为偏好可判断其性别为“女”的概率为80%。
  - 还得一提的是，储存用户行为数据时最好同时储存发生该行为的场景，以便更好地进行数据分析。
- 统计分析
- 建模分析
  - 该阶段是处理收集到的数据，注重大概率事件，通过数学算法模型尽可能地排除用户的偶然行为，进行行为建模，抽象出用户的标签。
  - 这时也要用到机器学习预测用户的行为偏好。好比一个 y＝kx＋b 的算法，X 代表已知信息（即用户标签），Y 是用户偏好，通过不断的精确 k 和 b 来精确 Y。
  - 这个阶段，需要用到很多模型给用户贴标签。比如：
    - 用户汽车模型：根据用户对“汽车”话题的关注或购买相关产品的情况来判断用户是否有车、是否准备买车
    - 用户忠诚度模型：通过判断＋聚类算法判断用户的忠诚度
    - 身高体型模型：根据用户购买服装鞋帽等用品判断
    - 用户价值模型：判断用户对于网站的价值，对于提高用户留存率非常有用（电商网站一般使用RFM 实现）
    - 还有消费能力、违约概率、流失概率等等诸多模型
- 用户画像基本成型
  - 把用户的基本属性（年龄、性别、地域）、购买能力、行为特征、兴趣爱好、心理特征和社交网络等大致地标签化。
  - 为什么说是基本成型？因为用户画像永远也无法100％地描述一个人，只能做到不断地去逼近。因此，用户画像既应根据变化的基础数据不断修正，又要根据已知数据来抽象出新的标签使用户画像越来越立体。
  - 一般采用多级标签、多级分类进行“标签化”，比如第一级标签是基本信息（姓名、性别），第二级是消费习惯、用户行为；第一级分类有人口属性，人口属性又有基本信息、地理位置等二级分类，地理位置又分工作地址和家庭地址的三级分类。

<ul> 
<li markdown="1"> 
![]({{site.baseurl}}/img/Recommendation System/标签体系2.png) 
</li> 
</ul> 

<ul> 
<li markdown="1"> 
![]({{site.baseurl}}/img/Recommendation System/标签体系.png) 
</li> 
</ul> 



#### 标签分类

<ul> 
<li markdown="1"> 
![]({{site.baseurl}}/img/Recommendation System/标签分类.png) 
</li> 
</ul> 

- 
- 



### Knowledge-based data (as opposed to historical data)

- user requirements, goals



### 开源数据集

- 缺少像imageNet那样的大数据集
- https://www.librec.net/datasets.html



### 参考资料

- https://github.com/microsoft/recommenders/wiki/Documents-and-Presentations
- 推荐系统实战 chapter2
- https://zhuanlan.zhihu.com/p/97209056
- 推荐系统三十六式
- https://www.zhihu.com/question/19853605
- https://blog.csdn.net/zzhhoubin/article/details/79727130
- https://blog.csdn.net/zw0Pi8G5C1x/article/details/83964888
