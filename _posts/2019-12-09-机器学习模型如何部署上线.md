---
layout:     post
title:      机器学习模型如何部署上线
subtitle:   
date:       2019-12-09
author:     bjmsong
header-img: img/machineLearning/machineLearning.png
catalog: true
tags:
    - 机器学习

---

>

**https://www.coursera.org/learn/deploying-machine-learning-models**

#### 按场景分类(from ppj)：
- 实时、小数据量
	- SOA调用python-httpserver
	- 需要启动服务（什么是服务？），需要跨环境(java跨到python)
	- 一次1000条或者更少请求的预测,95%结果在100ms返回
	- 更大的数据量,建议分批调用或者采用多线程
- 实时、大数据量
	- SOA
	- 将模型转换成pmml：把模型封装成一个类，用java调这个类来预测
		- pmml转换方法
	- 不依赖于任何环境
	- 速度快，稳定
- 离线(offline)
	- contab定时调度，运行python脚本


#### 在线web服务
- 训练的模型持久化
    - json模块
	    - json.dump:将python对象编码成json字符串
	    - json.loads:将json字符串解码为python对象
    - pickle模块
	    - 将对象以文件形式存放在硬盘上
	    - 只能在python中使用
	    - pickle.dump:序列化对象,并将结果数据流写入到文件对象中
	    - pickle.load
    - sklearn的joblib模块
    	- joblib.dump
	    - joblib.load
    - spark
		- save到文件
    - tensorflow
		- tf.train.Saver
- 搭建web服务：通过web接受客户端请求，在服务端处理，并返回结果到web
    - Flask
    - Django
    - Bottle
- 服务器接收数据，加载模型并预测，结果返回,开放REST API给别人调用
	- REST ： 表现层状态转移
	- RPC ： 远程过程调用
		- 远程过程调用
		- 计算机通信协议
		- 允许一台计算机的程序调用另一台计算机的子程序


在线预测：就是把训练好的模型部署在线上应用系统中，提供预测接口和服务供其他应用系统调用。
https://blog.csdn.net/FRBeVrQbN4L/article/details/78536875
- 特征构建(最关键)
	- 采集到kafka，然后使用spark/storm构建实时数据仓库。
	- 以redis存储
	    - 内存数据库
        在使用时，我们可以将 Redis 看成一个巨大的哈希表。Redis 在后台开发中经常用作 cache 服务器, 后来被工程师们用于广告和推荐系统中的特征服务器。工程师将用户和广告（物品）的 ID 作为 Key，将用户和广告（物品）的特征作为 Value 存入 Redis，这样线上程序只需要用户和广告（物品）的 ID 就能知道特征。
- 定期更新模型
	- 主动定时拉取
	- 被动推送：训练模型，更新zookeeper上的更新标示，通知在线预测服务拉取新模型
		- online learning



#### tensorflow serving
- https://tensorflow.google.cn/tfx/guide/serving
- https://github.com/edvardHua/Articles
- https://www.jianshu.com/p/2fffd0e332bc
- https://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&mid=2651747829&idx=1&sn=87ab95052cd48400e85d3c59c1f8b168&chksm=bd12acb88a6525aec945bd8ddd3055e3f16564661a34b042cd0310b949ee7752f5a9e48ae335&scene=21#wechat_redirect
- 深度学习在美团的工程实践
https://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&mid=2651749161&idx=1&sn=2a34bc1e36fbf259ac63ffe7c94f528b&chksm=bd12a2648a652b72a9027a572a0038d3b8a6448949c53e7aefab617a12811da84efdc88bcd29&mpshare=1&scene=1&srcid=1025pjqMWAMqES7L6Vsb6QTE#rd




- 加速推断
    - 算法加速
    降维、量化、剪枝、二值网络
    - 硬件加速
    GPU、FPGA、asic、端计算


### 微服务
- 单个小型的但有业务功能的服务，每个服务都有自己的处理和轻量通讯机制
- web servce
- 相对于SOA
- 基于Spring Cloud
- python:flask+gunicorn



- Clipper
	- 开源
	- 预测服务系统

HTTP
- 超文本传输协议
- 保证客户机和服务器之间的通信
- GET:从指定的资源请求数据
- POST:向指定的资源提交要被处理的数据

tomcat
- 开源的小型服务器
	
	

spring：嘟嘟独立博客


### PredictionIO
- 开源的机器学习服务器
- http://predictionio.apache.org/index.html
- https://github.com/apache/predictionio
- https://www.jianshu.com/p/3cf6ed43a3ff
- https://www.sohu.com/a/203504539_465229



### 参考资料