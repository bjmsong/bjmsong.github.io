---
layout:     post
title:      大规模数据处理实战之
subtitle:   实战学习大规模数据处理基本功
date:       2020-04-18
author:     bjmsong
header-img: img/bigdata/bigdata.jpg
catalog: true
tags:
    - big data
---

## 分布式系统：学会用服务等级协议SLA来评估你的系统
- SLA：Service-Level Agreement 服务等级协议
    - 系统服务提供者对客户的一个服务承诺
    - 是衡量大型分布式系统是否健康的常见方法
- SLA指标
    - 可用性(Availabilty)
        - 系统服务能正常运行所占的时间百分比
        - 高可用：99.99%的可用性，每年约50分钟的系统中断时间
    - 准确性
        - 是否允许某些数据是不准确的或者是丢失了的。如果允许这样的情况发生，用户可以接受的概率是多少？
        - 错误率
    - 系统容量(Capacity)
        - 系统能够支持的预期负载量，一般以每秒的请求数为单位来表示
        - QPS：Queries Per Second
    - 延迟(Latency)
        - 系统在收到用户的请求到响应这个请求之间的时间间隔


## 分布式系统：架构师必知的三大指标
- 可扩展性(Scaling)
    - 水平扩展：增加新的机器节点
    - 垂直扩展：升级机器性能，比如增加内存
    - 数据存储系统
        - 传统的关系型数据库因为表与表之间的数据有关联，经常要进行join操作，所有数据要存放在单机系统中，很难支持水平扩展
        - NoSQL数据库天生支持水平扩展，如BigTable，MongoDB，Redis
- 一致性(Consistency)
    - 一般来说，构成分布式系统的机器节点的可用性要低于系统的可用性 
    - 保证系统中不同的机器节点在同一时间，接收到和输出的数据是一致的
- 持久性(Durability)
    - 数据持久性
        - 数据一旦被成功存储就可以一直继续使用，即使系统中的节点下线、宕机或数据损坏
        - 数据备份到不同的节点
    - 消息持久性
        - 节点之间需要经常互发消息去同步以保证一致性
            - 分布式消息服务：RabbitMQ、Kafka
        - 当消息服务的节点发生了错误，已经发送的消息仍然会在错误解决之后被处理
        - 如果一个消息队列声明了持久性，那么即使队列在消息发送之后掉线，仍然会在重新上线之后收到这条消息

## 批处理(Batch) vs 流处理(Streaming)
- 无边界数据
- 有边界数据

- 事件时间：数据实际产生的时间
- 处理时间：处理数据的系统架构实际接收到这个数据的时间

- 批处理
    - 有边界数据，事件时间
    - 高延迟
- 流处理
    - 无边界数据
    - 低延迟


## Workflow设计模式
- 复制模式
    - 将单个数据处理模块中的数据，完整地复制到两个或更多的数据处理模块中，然后再由不同的数据处理模块进行处理
- 过滤模式
- 分离模式
- 合并模式

## 发布/订阅模式(Publish/Subscribe Pattern)
- 消息(Message)
    - 分布式架构中各个组件(Component)需要相互联系沟通
        - 组件：后台的数据库，前端的浏览器等
- 消息队列(Message Queue)  
    - 消息队列在发布 / 订阅模式中起的是一个持久化缓冲（Durable Buffer)的作用
    - 消息的发送方可以发送任意消息至这个消息队列中，消息队列在接收到消息之后会将消息保存好，直到消息的接收方确认已经从这个队列拿到了这个消息，才会将这条消息从消息队列中删除。
- 发布/订阅模式
    - 发布 / 订阅模式指的是消息的发送方可以将消息异步地发送给一个系统中不同组件，而无需知道接收方是谁。
    - 优点
        - 松耦合：消息的发布者和消息的订阅者在开发的时候完全不需要事先知道对方的存在，可以独立地进行开发
        - 高伸缩性：消息队列可以独立的作为一个数据存储中心存在。
        - 系统组件间通信更加简洁
    - 缺点
        - 不能保证发布者发送的数据一定会送达订阅者
- Apache Kafka
    - Producer -> Topic -> Consumer
- 适合场景