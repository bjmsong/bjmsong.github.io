---
layout:     post
title:      样本不平衡问题
subtitle:   
date:       2020-02-19
author:     bjmsong
header-img: img/machineLearning/machineLearning.png
catalog: true
tags:
    - 机器学习
---


## 模型效果评估指标图

- Confusion Matrix （混淆矩阵）

  <ul> 
  <li markdown="1"> 
  Recall = true positive/total actual positive
  Precision =true positive/ total predicted positive
  F1 = 2*(Precision*Recall)/(Precision+Recall)
  ![]({{site.baseurl}}/img/machineLearning/confusion matrix.png) 
  </li> 
  </ul> 

- Lift

- ROC曲线 & PR曲线 & KS曲线

- Cumulative gains chart

- Silhouette Analysis

- Learning Curve



## 评价指标

- ROC
- AUC

- ks检验

- MAE、RMSE、MAPE



## 解决方法

- 想办法弄到更多的数据

- 过采样/欠采样：smote

- 使用更好的metrics：auc、f1
  - AUC很好，线上效果却不怎么好？

  \-   拿预测结果与真实值再做一次拟合

  \-   换指标—容易被正负样本比例影响的指标：PR曲线的F1 score

  原因：在样本比例变得不平衡之后（负样本远多于正样本），ROC曲线变化不大，而PR曲线会有较大的变化，更能正确反映出分类器的性能。

  - ROC：纵轴—召回率，横轴—假正例率

- 调参，如xgboost

  - min_child_weight 设的小一点

  - scale_pos_weight = 0值的样本数量/1值的样本数量

  - max_delta_step

- 自定义loss function

- 自定义评价函数

  ```
  xgb.train(params, dtrain, num_rounds, watchlist, feval=misclassified, maximize=False)
  
  def misclassified(pred_probs, dtrain):
  
  	labels = dtrain.get_label() # obtain true labels
  
  	preds = pred_probs > 0.5 # obtain predicted values
  
  	return 'misclassified', np.sum(labels != preds)
  ```

- 设置weight：如spark初始化DMatrix

  

## 参考资料

- [腾讯技术工程-机器学习模型可解释性的详尽介绍](https://www.jiqizhixin.com/articles/2019-10-30-9)

