---
layout:     post
title:      effective python之部署
subtitle:   
date:       2020-02-12
author:     bjmsong
header-img: img/language/python.jpg
catalog: true
tags:
    - python
---



> 若想将Python程序付诸应用，就必须把它从开发环境部署到**生产环境**。令程序支持好几套不同的配置方案颇有些难度。我们要设法保证程序在各种情境下都能可靠地运作，这与实现正确的功能，是一样重要的。
>
> 所以，我们要将Python程序**产品化(productionize)**，令其能够稳定地运行在实际环境中。开发者可以通过某些内置的模块提供的调试、优化和测试功能，把程序打造地更加**健壮**，更有效率。



### 54. 考虑用模块级别的代码来配置不同的部署环境

- 部署环境（deployment environment）：程序在运行的时候所用的一套配置
  - 开发环境、测试环境、生产环境
- `pyvenv`：使得开发者能够保证所有的环境都装有同一套Python软件包
- 但是生产环境通常还会依赖很多外部的先决条件（external assumption），这些先决条件，很难在开发环境里重现
- **最佳解决方案：程序启动的时候，覆写其中的某些部分，以便根据部署环境，来提供不同的功能**
- 把环境相关的信息加入配置文件中，实现代码和配置分离



### 55. 通过repr字符串来输出调试信息

- 针对内置的Python类型来调用print函数，会根据该值打印出一条易于阅读的字符串，但是这个字符串隐藏了类型信息

- 针对内置的Python类型来调用repr函数，会根据该值返回一条可供打印的字符串。把这个repr字符串传给内置的eval函数，就可以将其还原为数值的那个值。

  ```
  print(repr(5))
  print(repr('5'))
  ```

- 可以在类中编写`__repr__`方法，用自定义的方式来提供一种可供打印的字符串，并在其中给出更为详细的调试信息

- 可以在任意对象上面查询`__dict__`属性，以观察其内部信息



### 56. 用unittest来测试全部代码

- Python是动态语言，Python没有静态类型检查机制，编译器不能保证程序一定会在运行的时候正确地执行

  - 优点：代码更短小，更加简洁，从而提高编程效率，开发者可以非常容易地为代码编写测试
  - 缺点：运行时容易出现荒唐的错误

- 无论用哪种语言编程，我们都应该测试自己所写的代码

  - Python尤其需要
  - **可以把编写测试看成给程序代码购买保险**
  - 测试可以使我们确信：代码可以在运行的时候表现出正确的行为
  - 重构代码后，可以通过测试非常方便地判断出代码行为有么有发生改变，修改Python程序更方便

- unittest模块

  - TestCase类的形式来组织
  - 辅助方法，以供开发者在编写测试的时候做出各种断言：assertEqual，assertTrue，assertRaises 。。。

- 必须同时编写单元测试和集成测试，前者用来独立检验程序中的每个功能，而后者则用来检验模块之间的交互行为

  



### 57. 考虑用pdb实现交互调试

- 



### 58. 先分析性能，再优化

- 



### 59.用tracemalloc来掌握内存的使用及泄露情况

- 





### 参考资料

- 《effective python》第八章