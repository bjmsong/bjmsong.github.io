---
layout:     post
title:      代码整洁之道
subtitle:   
date:       2019-10-01
author:     bjmsong
header-img: img/code.jpg
catalog: true
tags:
    - Computer Science
---
### 专业主义

**软件开发者跟其它领域的专业人士一样：医生、律师、音乐家。。**
- 担当责任
    - 为交付的代码负责
- 不行损害之事
    - 不要破坏软件功能
        - 让QA找不出任何问题
        - **要确信代码能正常运行**
            - 自动化测试
            - 测试覆盖100%代码
            - 测试驱动开发
        - 自动化QA
    - 不要破坏结构
        - 软件要易于修改
- 职业道德
    - **职业发展是你自己的事，雇主没有义务**
    - **为了成为专业人士，需要在工作时间之外，追求自己热爱的事情**
    - **了解你的领域**
        - **过去50年中产生的理念，已经过时的其实很少**
        - 专业软件开发人员必须精通
            - **设计模式：24种**
            - **设计原则：SOLID原则、组件设计原则**
            - **方法：XP、Scrum、精益、看板、瀑布、结构化分析、结构化设计**
            - **实践：测试驱动开发、面向对象设计、结构化编程、持续集成、结对编程**
            - **工件：UML、DFD、结构图、Petri网络图、状态迁移图表、流程图、决策表**
    - 坚持学习
    - 练习
    - 合作
    - 辅导
    - 了解业务领域 
    - 与雇主/客户保持一致
    - 谦逊



### 说“不”

- 专业人士干预说明真相而不屈从于权势,有勇气说“不”
- 要有团队精神：有团队精神的人会频繁与大家交流，会关心队友，会竭力做到尽职尽责。
- 说“是”的成本
    - 一个toB项目的典型场景
        - 客户需求阻碍程序员写出真正高品质的程序
        - 客户所要的功能，一旦写起来，总是远比它开始时所说的要复杂许多
        - 尽管客户一再声明交付日期很重要，尽管他们对此表现得似乎非常迫切，但他们永远不会像你那样在乎程序的按时交付



### 说“是”

- 承诺用语
    - 很少有人会认真对待自己说的话，并且说到做到
    - “缺乏承诺”的征兆
        - “需要/应当”，“希望/但愿”，“让我们”
    - 如果无法兑现承诺，要尽早向你的承诺对象发出预警，越快越好。
- 坚守原则
    - 打破纪律和原则（单元测试、不做重构。。。），必然会拖慢进度



### 编码

- 要熟练掌握某项技艺，关键是要具备“信心”和“出错感知”（即时反馈）的能力
- 编码时要平衡多种因素
    - 代码能够正常工作
    - 能够满足客户的真实需求
    - 遵循稳健的工程原则，和现有系统结合得天衣无缝
    - 其他程序员能读懂你的代码：注释、精心锤炼代码
- 感到疲劳或者心烦意乱时，千万不要编码。强而为之，最终只能再回头返工。 
- 流态区
    - 意识高度专注但思维视野却会收拢到狭窄的状态
    - 放弃了顾及全局
        - 避免进入流态区
    - 被打断时，礼貌地表现出乐于助人的态度才是专业的态度
- 阻塞
    - 找一个搭档结对编程
    - 创造性输出依赖于创造性输入
        - **广泛阅读、经历各种不同领域，会激发创造力**
- 调试
- 保持节奏
    - 软件开发是场马拉松，而不是短跑
    - **了解你的创造力和智力运行的模式，充分发挥它们的优势而非背道而驰**
    - 从问题中暂时脱离出来，有助于大脑以不同的但更具创造性的方式搜求各种解决方案
- 进度延迟
    - **管理延迟的诀窍，是早期检测和保持透明**
    - 不要经受不住诱惑盲目冲刺
    - 如果连续两三周都要加班，则加班的措施必然失败
    - **定义“完成”标准：创建一个自动化的验收测试 (by 业务分析师 & 测试人员)**
- 帮助
    - **必须小心谨慎地将系统分解为易于理解的小单元，同时这些单元之间的关系越少越好**。
    - **互相帮助是每个程序员的职责所在**
    - **要学会如何请求帮助**
        - 不要死命护住地盘拒绝别人的帮助
        - 如果帮助唾手可得却让自己一个人堵在那儿，是很不专业的表现
    - **程序员大多自负、固执、内向，并非天生是好的协作者**



### 测试驱动开发

- from 极限编程运动(XP)
- 三项法则
    - 在编好失败单元测试前，不要编写任何产品代码
        - 单测工具：Approval Tests
            - http://dontcodetired.com/blog/post/Approval-Tests-Write-Tests-More-Quickly
            - https://approvaltests.com/
    - 只要有一个单元测试失败了，就不要再写测试代码
    - 产品代码恰好能够让当前失败的单元测试成功通过即可，不要多写
- 优势
    - 确定性：代码有任何修改，都必须运行手头有的全部测试
    - 降低缺陷
        - 有效降低调试时间
    - 提高修改代码的勇气
    - 单元测试即文档
    - 程序设计
        - 测试先行的需要，会迫使你去考虑什么是好的设计，使函数之间解耦



### 练习

- 专业人士都需要通过专门训练提升自己的技能
- 保持不落伍的一种方法是为开源项目贡献代码



### 验收测试

- 职业程序员会重视与团队及业务部门的沟通
- 验收测试：业务方与开发方合作编写的测试，其目的在于确定需求已经完成
    - 确定了完成的标准
    - 确保业务方和开发方的需求理解一致
        - 本质是需求文档
    - **自动化测试：成本远低于手动测试**
- 业务分析人员和QA共同完成
- 推迟精细化：验收测试越晚越好
- 开发人员与QA协商并改进测试
- 验收测试不是单元测试
    - 单元测试
        - 面向程序员
        - 深入系统内部
    - 验收测试
        - 面向业务方
        - 系统外部
- **持续集成**
    - 持续集成系统由源代码管理系统来触发，只要有人提交了代码，持续集成系统就会开始构建，并运行所有的测试,测试结果发送给团队所有人。
    - 失败的持续集成应该被视为紧急情况



### 测试策略

- 开发小组要把“QA找不到任何错误”作为努力的目标
- QA也是团队的一部分
    - 需求规约定义者：构建自动化验收测试
    - 特性描述者
- 自动化测试金字塔
    - 单元测试
    - 组件测试
    - 集成测试
    - 系统测试
    - 人工探索式测试



### 时间管理

- 管理自己的时间是你的责任
- 会议
    - 如果会议没有现实且显著的成效，专业开发人员会主动拒绝
    - 如果会议让人厌烦，就（礼貌地）离席
    - 会议应当有清晰的议程，确定每个议题所花的时间，以及明确的目标
    - 站立会
        - 敏捷开发
        - 昨天干了什么，今天打算干什么，遇到了什么问题
        - 不超过1min
    - 迭代计划会议
        - 用来选择在下一轮迭代中实现的开发任务
    - 迭代回顾和DEMO展示
        - 总结
    - 争论/反对
        - 用数据说话
- 注意力点数
    - 稀缺资源
    - 妥善安排使用
    - 恢复
        - 睡眠
        - 做点不集中注意力的事情：散步、休息、聊天、看窗外、反省
        - **定期训练肌肉注意力，可以提升心智注意力的上限**
            - 运动有助于学习！
            - 跑步、游泳、健身、手工活
- 番茄工作法
    - 番茄时间段：有生产率的
- 避免  
    - 优先级错乱
    - 走入死胡同



### 预估

- 业务方觉得预估就是承诺，开发方认为预估是猜测
- PERT，把预估变成概率分布
    - 乐观预估：发生的概率小于1%
    - 标称预估：概率最大的数字
    - 悲观预估：发生的概率小于1%
    - 期望、标准差
- 德尔菲法：
    - 一起预估时间，直到意见统一
- 大任务拆成小任务，分开预估



### 压力

- 避免压力
    - 避免对没有把握的最终期限做出承诺
    - 让系统、代码、设计尽可能整洁
    - 危机中坚守纪律
- 应对压力
    - 不要惊慌失措
    - 沟通
    - 寻求帮助



### 协作

- 注意力集中在老板所追求的目标上
- 由整个团队拥有全部代码，通过合作来达到学习的目的
- 结对编程



### 团队与项目

- 有凝聚力的团队
    - 团队成员要建立关系
    - 学习如何互相协作
    - 了解彼此的癖好、强项、弱项
    - 需要时间
    - 两个匹萨的数量
    - 程序员+测试+业务分析师+项目经理+MASTER
- 围绕项目构建团队，是愚蠢的做法



### 辅导、学徒期与技艺



### 工具

- 源代码控制：git
- IDE
    - 不仅仅是操作代码行和字符，还可以进行各种复杂的操作
    - 缺点：学习成本、耗资源
- 问题跟踪
    - Pivotal Tracker,wiki
- 单元测试工具
    - 每个语言独有
- 组件测试工具
- 集成测试工具
- UML/MDA